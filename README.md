
# 已经完成了历史使命！





































# SevenSha1UIAdvancedHelper

转存助手ui优化版


---



---



> 逐步从gist迁移到github，方便版本管理以及issues的搜索。代码会在gist与此项目发布上同步。----2022.04.26

### 注意：

* 提取时遇到不能下载的文件获取到sha1链接（本脚本用40个0替换）是暂时有效的，等文件能下载了就会失效
* 转存时未过滤空目录，或者由于转存失败会导致空目录存在
* 使用时，不要最小化浏览器和切换tab页面，即：需要保持操作页面始终可见
* 适用于chrome或者 `<del>`v23版本的 `</del>`（新版已经支持v24）115，以及导入的文件需要为utf-8编码
* 如果转存失败，请检查链接或者在chrome上进行尝试，115pc端偶尔抽风；或者可能与其他脚本冲突，导致显示元素不完整
* 遇到问题，反馈时请描述你使用的【浏览器】，【浏览器版本】，【什么操作】，【链接】，【错误提示】，要不然无法进行错误复现。

### v3.3起 特别注意：

* [!].为保证【转存】时【自动去除分隔符】正确运行，请勿同时多开进行转存操作（包括同时多页面转存，或者跟其他工具同时转存）；分割符请使用生僻汉字！
* [!].请使用chrome和115pc最新版，以及Tampermonkey最新版！！！！
* [!].请保证你的网络和浏览器能访问代码中的依赖库！！！

### 计划中

* [ ] 代码优化，使得卡ui几率降低
* [ ] 优化去除分隔符功能
* [ ] 卡住或者被115ban时，能够保存下信息，以供稍后继续

### 最近更新日志：

* v3.8.1 143.2022.0818.2

  1. 优化转存方案
  2. 下线“遍历文件夹”
* V3.7  143.2022.0816.1

  1.优化转存方案
  2.已上传文件，名字前面有空格的能够正确检测
  3.转存时遇到115服务器限制立即停止，不再继续发包
  4.目前方案，下线“手动去除分隔符”，改为“遍历文件夹”，方便转存文件按视频等格式分类
* v3.6  143.2022.0616.1
  fix：修复转存失败问题
  fix：优化发包速度，减少被ban几率
* v3.5  143.2022.0402.1
  fix：因115页面调整和接口改变导致无法保存指定目录，以及出现参数不匹配等问题；
  fix：优化“超时”提醒，缓解因“操作超时”提示失败，导致使用者心中的不安感
  update：因为1，暂时下线添加任务时，默认指定为当前目录功能
* v3.4     143.2022.0202.1
  fix：由于含有/:等字符导致文件夹或者文件不能下载到本地的问题——转存和提取遇到“：”“|”等9个字符会自动替换
  fix：不再兼容用“#”作为目录分隔符，即新版目录名称中可以含有“#”
  fix：子目录创建时，有同名文件夹，处理跟根目录相同处理
  fix：修复在线的json进行“尝试转存”失败的情况
  fix：弹窗时保存的位置可能数据还在获取，再次加长延迟：从200ms变成1000ms
  add：新增新设置：【列表模式下：悬浮条显示”获取sha1链接“】与【缩略图模式下：显示”获取sha1链接“】
  add：新增获取“脚本与环境信息”，入口在油猴设置处，方便报bug时准确
* v3.3.2   143.2022.0126.1
  针对网络问题，只能将不稳定的依赖库置于源代码内
* V3.3.1  143.2022.0122.1
  fix:缩略图模式下，如果文件夹设置了封面，”获取sha1链接“按钮会覆盖整个区域。
  fix:如果链接里有重复文件，转存后自动去除分隔符，重复的文件只改了一个，另外几个没有去除
  fix:缓解“添加任务”弹窗，脚本修改保存位置比115修改快，导致自动修改位置失败的bug
* v3.3  143.2022.0114.1
  [*]. 新增懒人操作1：对在线的sha1文本文件（.txt,.json）可进行【尝试转存】，防止浏览器卡住，要求sha1文本文件小于2MB
  [*]. 新增懒人操作2：打开【添加链接任务】弹窗时，“保存到”的位置自动定位到当前目录
  [*].【转存】时【自动去除分隔符】，已经不需要勾选【强制在保存处新建根目录】，并且速度更快了（即：不自动生成根目录成功，也可以应用自动去除分隔符 ）
  [*]. 自动创建的根目录，已从时间戳改为人类能看懂的时间
  [*]. 点击【开始sha1转存】，此前有概率不能关闭【添加链接任务】弹窗，此版本应该改善很多
  [*].【转存】与【提取】的操作加了“超时”操作，【提取】另外完善对404文件的处理，对于操作中卡住的情况应该改善很多
  [*]. 用导入的文件名作为自动创建的根目录时，"."变","的行为已经修正
  [*]. 提取时如果目录名含有"|"，为保证导入的目录结构正确性，会修改"|"为"/"
  [*]. 优化了在创建子目录过程中ui卡住的问题，自测自用没有问题，但不保证
  [*]. 其他ui优化，如此前在分享页面出现【链接与sha1转存任务】按钮等做了调整，其他不再一一列举
* v3.2.1  143.2021.1220.1
  v3.2.1替换了cdn.jsdelivr.net的源;否则无法使用正常
* v3.2  143.2021.1211.1
  1.新增“获取选中项的sha1”：方便手机上或者多选提取，文件和目录可一起选择，列表模式与缩略图模式下皆可（感谢@qbz95老哥的打赏支持！）
  2.优化小文件提取：新版本对于小文件（128KB以下）不进行向服务器发包，如果小文件较多，提取速度会快很多
  3.优化出错文件提取：某些文件115服务器无法下载或者返回信息出错，新版本已经优化，提取无限卡住应该已经改善或者解决
  4.已经隐藏uiddiv：有老哥提出115截图可能会含有隐藏的uid信息，新版本已经隐藏，可再测试是否有效（感谢@ﾜｰﾝ ｼｱｰﾝ老哥测试，以及@Yves Lelouch老哥的解决方案）
  5.提示ui的改进
* v3.1  143.2021.1015.1

1. 文件中含有"."已经能正确改名（上一版本会变成"，"，注意不要用”."作为分隔符)
2. 缩略图模式下,对于文件夹和文件添加获取sha1链接按钮
3. 添加任务界面,增加多处提示,方便"九年义务教育漏网之鱼"的使用
4. 自动创建根目录,已经修改逻辑,只要勾上,就能自动创建成功

* 143.2021.0911.1
  09.11修复waitForKeyElements.js的依赖问题 （由于greasyfork上的WaitForKeyElements.js的库被删，导致无法实现正常功能）
* 143.2021.0907.1
  1.新增加设置界面，可设置脚本的显示任务与默认参数
  2.“sha1转存时，强制在保存处新建根目录” 的默认值，可在设置界面配置
  3.“sha1转存时，不创建任何子目录”的显示与否，可在设置界面配置
  4.对于目录，悬浮工具条增加“去除分隔符”功能，即：去除该目录下所有文件的分隔符
  5.默认设置【转存时给文件名添加分隔符，转存完成后去除分隔符重命名】一条龙功能
  6.在5中的，添加分隔符，去除分割符，分隔符方案都可以在设置中配置
  7.由于115接口的进一步抓紧，时间参数不可配置，并增加了更多提示信息
  8.转存过程中以及失败复制到剪贴板的文件名，修改为原来文件名，方便排查
* 143.2021.0822.3
  修复由于115上传接口更改导致不显示上传失败的原因
* 143.2021.0822.2
  修复转存时无响应:因为自身带有emoji的文件名,再强制分隔时出错
* 143.2021.0822.1
  修复ui错位,增加提示等ui优化;
  增加:
  强制在保存处新建根目录;
  强制在文件名中加入分隔符;
  提取时可以取消,并且保存已提取内容;
  提取时已经设置超时处理;
  转存完成时,新增"打开目录"按钮
* 1.4.3.20210422.0
  优化提示次数：每天1次；优化大小为0的文件提取
* 1.4.3.20210415.0
  不能下载的文件提供暂时的转存链接，40个0结尾，注意：文件能下载时，该链接就会不匹配！
  修复多重目录转存时可能存在结构错位的问题
* 1.4.3.20210307.1
  “转存”处增加“要不要创建目录”的选择项
  搜索处增加了单个文件已经单个目录的sha1提取（鼠标悬停时的tooltip上）
  搜索处增加对本页所有和选中的文件的提取（排除目录，因为这样可能会重复提取文件；并且只是当前页）
* 1.4.3.20210305.0
  修复115pc版v24版（v24.0.2.2）提取的支持
* 1.4.3.20210304.2
  修复转存时遇到&导致的问题，包括文件名截断以及目录创建失败
  修复未刷新网页的情况下可能在未选择文件的情况下，重复使用上次文件的情况
* 1.4.3.20210304.1
  解决由于“异常文件，无法下载”导致提取卡住的bug
  优化转存出错时的提醒
* 1.4.3.20210303.1
  屏蔽esc减导致进度条弹窗退出
  优化平衡速度
* 1.4.3.20210302
  支持直接导入sha1链接文件（符合格式的.txt和.json）
  优化提取策略，大于1200数量，慢速
* 1.4.3.20210301
  修复同一目录下存在相同文件导致提取死循环的bug
* 1.4.3.20210227
  计数bug修改，修改代码适配115浏览器
* 1.4.3.20210209
  优化代码，增加目录
* ......
